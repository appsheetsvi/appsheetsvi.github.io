<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</title>
  <style>
    body { font-family: 'Sarabun', sans-serif; background: #f7f9fc; margin: 0; padding: 0; }
    .navbar {
      display: flex; justify-content: space-between; align-items: center;
      background: #1976d2; color: white; padding: 0.5rem 1rem; font-weight: bold;
    }
    .container { max-width: 960px; margin: 1rem auto; padding: 1rem; background: white; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    th { background-color: #e3f2fd; }
    tr:hover { background-color: #f1faff; }
    .btn { text-decoration: none; padding: 0.3rem 0.8rem; background: #1565c0; color: white; border-radius: 4px; }
  </style>
</head>
<body>

<div class="navbar">
  <div>üìÑ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</div>
  <div>
    üë§ <span id="empDisplay">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
    <a href="menu.html" class="btn">üè† ‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</a>
  </div>
</div>

<div class="container">
  <h2>üìã ‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏â‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</h2>
  <table id="repairTable">
    <thead>
      <tr>
        <th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á</th>
        <th>‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</th>
        <th>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢</th>
        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
  const user = JSON.parse(localStorage.getItem("user"));
  if (!user || !user.EmpCode) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô");
    window.location.href = "login.html";
  } else {
    document.getElementById("empDisplay").textContent = `${user.EmpCode} ${user.EmpName || ""} ${user.LastName || ""}`;
  }

  const appId = "ae5d7dce-1c12-4c53-b201-5a2d7c5b5411";
  const apiKey = "V2-b1wGR-Nj1SR-0MhEx-QWCHT-Mllly-cZnc9-PHCAK-r1f85";
  const baseUrl = `https://api.appsheet.com/api/v2/apps/${appId}/tables/RepairTechnicians/Find`;

  async function loadRepairs() {
    const res = await fetch(baseUrl, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "ApplicationAccessKey": apiKey
      },
      body: JSON.stringify({
        filter: `EmpCode = "${user.EmpCode}"`
      })
    });

    const data = await res.json();
    const tbody = document.querySelector("#repairTable tbody");
    tbody.innerHTML = "";

    data.forEach(row => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row['‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°']}</td>
        <td>${row['‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á'] || "-"}</td>
        <td>${row['‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢'] || "-"}</td>
        <td>${row['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô‡∏ä‡πà‡∏≤‡∏á'] || "-"}</td>
        <td><a class="btn" href="tech-detail.html?request=${encodeURIComponent(row['‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°'])}">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</a></td>
      `;
      tbody.appendChild(tr);
    });
  }

  loadRepairs();
</script>

</body>
</html>
